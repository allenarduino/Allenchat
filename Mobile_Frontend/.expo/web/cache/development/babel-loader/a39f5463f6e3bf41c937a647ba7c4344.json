{"ast":null,"code":"import * as React from 'react';\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport { ActionSheetIOS } from \"react-native-web/dist/index\";\nimport UIManager from \"react-native-web/dist/exports/UIManager\";\nimport findNodeHandle from \"react-native-web/dist/exports/findNodeHandle\";\nimport View from \"react-native-web/dist/exports/View\";\nimport { HiddenItem } from \"./HeaderItems\";\nimport invariant from 'invariant';\nexport var extractOverflowButtonData = function extractOverflowButtonData(hiddenButtons) {\n  var detectedElementTypes = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [HiddenItem];\n  var btnsData = React.Children.toArray(hiddenButtons).map(function (button) {\n    var props = button.props,\n        type = button.type;\n\n    if (detectedElementTypes.includes(type)) {\n      return extract(button);\n    }\n\n    if (typeof type === 'function') {\n      var nestedElement = callSafe(type, props);\n\n      if (nestedElement && detectedElementTypes.includes(nestedElement.type)) {\n        return extract(nestedElement);\n      }\n    }\n\n    return false;\n  });\n  return btnsData.filter(Boolean);\n};\n\nvar callSafe = function callSafe(type, props) {\n  try {\n    return type(props);\n  } catch (_unused) {\n    return false;\n  }\n};\n\nvar extract = function extract(element) {\n  var _element$props = element.props,\n      title = _element$props.title,\n      onPress = _element$props.onPress,\n      disabled = _element$props.disabled,\n      destructive = _element$props.destructive;\n  return {\n    title: title,\n    onPress: onPress,\n    destructive: destructive === true,\n    disabled: disabled === true\n  };\n};\n\nvar checkParams = function checkParams(hiddenButtons) {\n  invariant(Array.isArray(hiddenButtons), 'hiddenButtons must be an array');\n};\n\nexport var overflowMenuPressHandlerActionSheet = function overflowMenuPressHandlerActionSheet(_ref) {\n  var hiddenButtons = _ref.hiddenButtons,\n      _ref$cancelButtonLabe = _ref.cancelButtonLabel,\n      cancelButtonLabel = _ref$cancelButtonLabe === void 0 ? 'Cancel' : _ref$cancelButtonLabe;\n  checkParams(hiddenButtons);\n  var enabledButtons = hiddenButtons.filter(function (it) {\n    return it.disabled !== true;\n  });\n  var actionTitles = enabledButtons.map(function (btn) {\n    return btn.title;\n  });\n  actionTitles.unshift(cancelButtonLabel);\n  var destructiveActions = enabledButtons.reduce(function (acc, btn, index) {\n    if (btn.destructive) {\n      acc.push(index + 1);\n    }\n\n    return acc;\n  }, []);\n  ActionSheetIOS.showActionSheetWithOptions({\n    options: actionTitles,\n    cancelButtonIndex: 0,\n    destructiveButtonIndex: destructiveActions\n  }, function (buttonIndex) {\n    if (buttonIndex > 0) {\n      hiddenButtons[buttonIndex - 1].onPress();\n    }\n  });\n};\nexport var overflowMenuPressHandlerPopupMenu = function overflowMenuPressHandlerPopupMenu(_ref2) {\n  var hiddenButtons = _ref2.hiddenButtons,\n      overflowButtonRef = _ref2.overflowButtonRef;\n  checkParams(hiddenButtons);\n  var enabledButtons = hiddenButtons.filter(function (it) {\n    return it.disabled !== true;\n  });\n  UIManager.showPopupMenu(findNodeHandle(overflowButtonRef), enabledButtons.map(function (btn) {\n    return btn.title;\n  }), function (err) {\n    return console.debug('overflowBtn error', err);\n  }, function (eventName, index) {\n    if (eventName !== 'itemSelected' || typeof index !== 'number') {\n      return;\n    }\n\n    enabledButtons[index].onPress();\n  });\n};\nexport var overflowMenuPressHandlerDropdownMenu = function overflowMenuPressHandlerDropdownMenu(_ref3) {\n  var children = _ref3.children,\n      overflowButtonRef = _ref3.overflowButtonRef,\n      _private_toggleMenu = _ref3._private_toggleMenu;\n\n  if (overflowButtonRef) {\n    overflowButtonRef.measureInWindow(function (x, y, width) {\n      _private_toggleMenu({\n        elements: children,\n        x: x + width,\n        y: y\n      });\n    });\n  } else {}\n};\nexport var defaultOnOverflowMenuPress = Platform.select({\n  ios: overflowMenuPressHandlerActionSheet,\n  default: overflowMenuPressHandlerDropdownMenu\n});","map":{"version":3,"sources":["/media/allen/SIMBAD/Flaskprojects/CodeReservoir/codereservoir/node_modules/react-navigation-header-buttons/src/overflowMenuPressHandlers.js"],"names":["React","ActionSheetIOS","HiddenItem","invariant","extractOverflowButtonData","hiddenButtons","detectedElementTypes","btnsData","Children","toArray","map","button","props","type","includes","extract","nestedElement","callSafe","filter","Boolean","element","title","onPress","disabled","destructive","checkParams","Array","isArray","overflowMenuPressHandlerActionSheet","cancelButtonLabel","enabledButtons","it","actionTitles","btn","unshift","destructiveActions","reduce","acc","index","push","showActionSheetWithOptions","options","cancelButtonIndex","destructiveButtonIndex","buttonIndex","overflowMenuPressHandlerPopupMenu","overflowButtonRef","UIManager","showPopupMenu","findNodeHandle","err","console","debug","eventName","overflowMenuPressHandlerDropdownMenu","children","_private_toggleMenu","measureInWindow","x","y","width","elements","defaultOnOverflowMenuPress","Platform","select","ios","default"],"mappings":"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","sourcesContent":["// @flow\nimport * as React from 'react';\nimport { Platform, ActionSheetIOS, UIManager, findNodeHandle, typeof View } from 'react-native';\nimport { HiddenItem } from './HeaderItems';\nimport invariant from 'invariant';\nimport type { ToggleMenuParam } from './overflowMenu/OverflowMenuContext';\n\ntype OverflowButtonDescriptors = $ReadOnlyArray<{\n  title: string,\n  onPress: () => void | Promise<void>,\n  destructive?: boolean,\n  disabled?: boolean,\n}>;\n\nexport const extractOverflowButtonData = (\n  hiddenButtons: React.Node,\n  detectedElementTypes: Array<React.StatelessFunctionalComponent<any>> = [HiddenItem]\n): OverflowButtonDescriptors => {\n  // don't do this at home - this is not how React is meant to be used!\n  const btnsData = React.Children.toArray(hiddenButtons).map((button) => {\n    const { props, type } = button;\n    if (detectedElementTypes.includes(type)) {\n      return extract(button);\n    }\n\n    if (typeof type === 'function') {\n      const nestedElement = callSafe(type, props);\n      if (nestedElement && detectedElementTypes.includes(nestedElement.type)) {\n        return extract(nestedElement);\n      }\n    }\n    return false;\n  });\n  // $FlowFixMe\n  return btnsData.filter(Boolean);\n};\n\nconst callSafe = (type, props) => {\n  try {\n    return type(props);\n  } catch {\n    return false;\n  }\n};\n\nconst extract = (element: React.Element<any>) => {\n  const {\n    props: { title, onPress, disabled, destructive },\n  } = element;\n  return { title, onPress, destructive: destructive === true, disabled: disabled === true };\n};\n\nexport type OnOverflowMenuPressParams = {\n  hiddenButtons: OverflowButtonDescriptors,\n  _private_toggleMenu: (ToggleMenuParam) => void,\n  overflowButtonRef: null | View,\n  cancelButtonLabel?: string,\n  children: React.Node,\n};\n\nconst checkParams = (hiddenButtons) => {\n  invariant(Array.isArray(hiddenButtons), 'hiddenButtons must be an array');\n};\n\nexport const overflowMenuPressHandlerActionSheet = ({\n  hiddenButtons,\n  cancelButtonLabel = 'Cancel',\n}: OnOverflowMenuPressParams) => {\n  checkParams(hiddenButtons);\n  const enabledButtons = hiddenButtons.filter((it) => it.disabled !== true);\n  let actionTitles = enabledButtons.map((btn) => btn.title);\n  actionTitles.unshift(cancelButtonLabel);\n  const destructiveActions: Array<number> = enabledButtons.reduce((acc, btn, index) => {\n    if (btn.destructive) {\n      acc.push(index + 1);\n    }\n    return acc;\n  }, []);\n\n  ActionSheetIOS.showActionSheetWithOptions(\n    {\n      options: actionTitles,\n      cancelButtonIndex: 0,\n      // $FlowFixMe\n      destructiveButtonIndex: destructiveActions,\n    },\n    (buttonIndex: number) => {\n      if (buttonIndex > 0) {\n        hiddenButtons[buttonIndex - 1].onPress();\n      }\n    }\n  );\n};\n\nexport const overflowMenuPressHandlerPopupMenu = ({\n  hiddenButtons,\n  overflowButtonRef,\n}: OnOverflowMenuPressParams) => {\n  checkParams(hiddenButtons);\n  const enabledButtons = hiddenButtons.filter((it) => it.disabled !== true);\n\n  UIManager.showPopupMenu(\n    findNodeHandle(overflowButtonRef),\n    enabledButtons.map((btn) => btn.title),\n    (err) => console.debug('overflowBtn error', err),\n    (eventName: string, index?: number) => {\n      if (eventName !== 'itemSelected' || typeof index !== 'number') {\n        return;\n      }\n      enabledButtons[index].onPress();\n    }\n  );\n};\n\nexport const overflowMenuPressHandlerDropdownMenu = ({\n  children,\n  overflowButtonRef,\n  _private_toggleMenu,\n}: OnOverflowMenuPressParams) => {\n  if (overflowButtonRef) {\n    // $FlowFixMe\n    overflowButtonRef.measureInWindow((x, y, width) => {\n      _private_toggleMenu({ elements: children, x: x + width, y });\n    });\n  } else {\n    // TODO ignore or show?\n  }\n};\n\nexport const defaultOnOverflowMenuPress: (OnOverflowMenuPressParams) => void = Platform.select({\n  ios: overflowMenuPressHandlerActionSheet,\n  default: overflowMenuPressHandlerDropdownMenu,\n});\n"]},"metadata":{},"sourceType":"module"}